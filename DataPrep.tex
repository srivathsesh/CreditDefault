\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Credit Default Prediction},
            pdfauthor={Sri Seshadri},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Credit Default Prediction}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Sri Seshadri}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{9/28/2019}

\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}

\begin{document}
\maketitle

\hypertarget{introduction}{%
\section{1. Introduction}\label{introduction}}

\hypertarget{executive-summary}{%
\section{2. Executive Summary}\label{executive-summary}}

\hypertarget{data}{%
\section{3. Data}\label{data}}

The

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(caret)}
\KeywordTok{library}\NormalTok{(magrittr)}
\KeywordTok{library}\NormalTok{(pander)}
\KeywordTok{library}\NormalTok{(knitr)}
\KeywordTok{library}\NormalTok{(kableExtra)}

\NormalTok{creditdata <-}\StringTok{ }\KeywordTok{readRDS}\NormalTok{(}\StringTok{"credit_card_default.RData"}\NormalTok{)}

\NormalTok{creditdata <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(creditdata) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as_tibble}\NormalTok{()}
\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate_at}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"DEFAULT"}\NormalTok{,}\StringTok{"EDUCATION"}\NormalTok{,}\StringTok{"MARRIAGE"}\NormalTok{,}\StringTok{"SEX"}\NormalTok{,}\StringTok{"data.group"}\NormalTok{),}\DataTypeTok{.funs =}\NormalTok{ as.factor)}

\NormalTok{Dict <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{FEATURE =} \KeywordTok{colnames}\NormalTok{(creditdata)[}\DecValTok{1}\OperatorTok{:}\DecValTok{25}\NormalTok{],}
               \DataTypeTok{DESCRIPTION =}
                 \KeywordTok{c}\NormalTok{(}\StringTok{"CUSTOMER ID"}\NormalTok{,}
                   \StringTok{"CREDIT LIMIT"}\NormalTok{,}
                   \StringTok{"GENDER"}\NormalTok{,}
                   \StringTok{"EDUCATION"}\NormalTok{,}
                   \StringTok{"MARITAL STATUS"}\NormalTok{,}
                   \StringTok{"AGE"}\NormalTok{,}
                   \StringTok{"REPAYMENT STATUS SEP 2005"}\NormalTok{,}
                   \StringTok{"REPAYMENT STATUS AUG 2005"}\NormalTok{,}
                   \StringTok{"REPAYMENT STATUS JUL 2005"}\NormalTok{,}
                   \StringTok{"REPAYMENT STATUS JUN 2005"}\NormalTok{,}
                   \StringTok{"REPAYMENT STATUS MAY 2005"}\NormalTok{,}
                   \StringTok{"REPAYMENT STATUS APR 2005"}\NormalTok{,}
                   \StringTok{"BILL SEP 2005"}\NormalTok{,}
                   \StringTok{"BILL AUG 2005"}\NormalTok{,}
                   \StringTok{"BILL JUL 2005"}\NormalTok{,}
                   \StringTok{"BILL JUN 2005"}\NormalTok{,}
                   \StringTok{"BILL MAY 2005"}\NormalTok{,}
                   \StringTok{"BILL APR 2005"}\NormalTok{,}
                   \StringTok{"PAYMENT SEP 2005"}\NormalTok{,}
                   \StringTok{"PAYMENT AUG 2005"}\NormalTok{,}
                   \StringTok{"PAYMENT JUL 2005"}\NormalTok{,}
                   \StringTok{"PAYMENT JUN 2005"}\NormalTok{,}
                   \StringTok{"PAYMENT MAY 2005"}\NormalTok{,}
                   \StringTok{"PAYMENT APR 2005"}\NormalTok{,}
                   \StringTok{"DEFAULTING CUSTOMER"}
\NormalTok{                  ),}
               \DataTypeTok{COMMENTS =} 
                 \KeywordTok{c}\NormalTok{(}\StringTok{""}\NormalTok{,}
                   \StringTok{"INCLUDES SUPPL CARDS"}\NormalTok{,}
                   \StringTok{"1 = MALE, 2 = FEMALE"}\NormalTok{,}
                   \StringTok{"1 = GRAD,2 = UNIV,3 = HIGH SCH,4 = OTHERS"}\NormalTok{,}
                   \StringTok{"1=MARRIED,2=SINGLE,3=OTHERS"}\NormalTok{,}
                   \StringTok{"YEARS"}\NormalTok{,}
                   \StringTok{"-1 = DULY PAID,1= 1 MONTH DELAY, 2 = 2 MONTH DELAY... 9 = >=9 MONTH DELAY"}\NormalTok{,}
                   \StringTok{"-1 = DULY PAID,1= 1 MONTH DELAY, 2 = 2 MONTH DELAY... 9 = >=9 MONTH DELAY"}\NormalTok{,}
                   \StringTok{"-1 = DULY PAID,1= 1 MONTH DELAY, 2 = 2 MONTH DELAY... 9 = >=9 MONTH DELAY"}\NormalTok{,}
                   \StringTok{"-1 = DULY PAID,1= 1 MONTH DELAY, 2 = 2 MONTH DELAY... 9 = >=9 MONTH DELAY"}\NormalTok{,}
                   \StringTok{"-1 = DULY PAID,1= 1 MONTH DELAY, 2 = 2 MONTH DELAY... 9 = >=9 MONTH DELAY"}\NormalTok{,}
                   \StringTok{"-1 = DULY PAID,1= 1 MONTH DELAY, 2 = 2 MONTH DELAY... 9 = >=9 MONTH DELAY"}\NormalTok{,}
                   \StringTok{"STATEMENT BALANCE"}\NormalTok{,}
                   \StringTok{"STATEMENT BALANCE"}\NormalTok{,}
                   \StringTok{"STATEMENT BALANCE"}\NormalTok{,}
                   \StringTok{"STATEMENT BALANCE"}\NormalTok{,}
                   \StringTok{"STATEMENT BALANCE"}\NormalTok{,}
                   \StringTok{"STATEMENT BALANCE"}\NormalTok{,}
                   \StringTok{"PAYMENT MADE"}\NormalTok{,}
                   \StringTok{"PAYMENT MADE"}\NormalTok{,}
                   \StringTok{"PAYMENT MADE"}\NormalTok{,}
                   \StringTok{"PAYMENT MADE"}\NormalTok{,}
                   \StringTok{"PAYMENT MADE"}\NormalTok{,}
                   \StringTok{"PAYMENT MADE"}\NormalTok{,}
                   \StringTok{"1 = DEFAULT, 0 = NON-DEFAULT"}
\NormalTok{                 )}
           
\NormalTok{       ) }

\KeywordTok{kable}\NormalTok{(Dict, }\DataTypeTok{align =} \StringTok{"c"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{kable_styling}\NormalTok{(}\DataTypeTok{full_width =}\NormalTok{ F) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{column_spec}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DataTypeTok{width =} \StringTok{"20em"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{collapse_rows}\NormalTok{(}\DataTypeTok{columns =} \DecValTok{3}\NormalTok{, }\DataTypeTok{valign =} \StringTok{"middle"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[H]
\centering
\begin{tabular}{c|c|>{\centering\arraybackslash}p{20em}}
\hline
FEATURE & DESCRIPTION & COMMENTS\\
\hline
ID & CUSTOMER ID & \\
\cline{1-3}
LIMIT\_BAL & CREDIT LIMIT & INCLUDES SUPPL CARDS\\
\cline{1-3}
SEX & GENDER & 1 = MALE, 2 = FEMALE\\
\cline{1-3}
EDUCATION & EDUCATION & 1 = GRAD,2 = UNIV,3 = HIGH SCH,4 = OTHERS\\
\cline{1-3}
MARRIAGE & MARITAL STATUS & 1=MARRIED,2=SINGLE,3=OTHERS\\
\cline{1-3}
AGE & AGE & YEARS\\
\cline{1-3}
PAY\_0 & REPAYMENT STATUS SEP 2005 & \\
\cline{1-2}
PAY\_2 & REPAYMENT STATUS AUG 2005 & \\
\cline{1-2}
PAY\_3 & REPAYMENT STATUS JUL 2005 & \\
\cline{1-2}
PAY\_4 & REPAYMENT STATUS JUN 2005 & \\
\cline{1-2}
PAY\_5 & REPAYMENT STATUS MAY 2005 & \\
\cline{1-2}
PAY\_6 & REPAYMENT STATUS APR 2005 & \multirow{-6}{20em}{\centering\arraybackslash -1 = DULY PAID,1= 1 MONTH DELAY, 2 = 2 MONTH DELAY... 9 = >=9 MONTH DELAY}\\
\cline{1-3}
BILL\_AMT1 & BILL SEP 2005 & \\
\cline{1-2}
BILL\_AMT2 & BILL AUG 2005 & \\
\cline{1-2}
BILL\_AMT3 & BILL JUL 2005 & \\
\cline{1-2}
BILL\_AMT4 & BILL JUN 2005 & \\
\cline{1-2}
BILL\_AMT5 & BILL MAY 2005 & \\
\cline{1-2}
BILL\_AMT6 & BILL APR 2005 & \multirow{-6}{20em}{\centering\arraybackslash STATEMENT BALANCE}\\
\cline{1-3}
PAY\_AMT1 & PAYMENT SEP 2005 & \\
\cline{1-2}
PAY\_AMT2 & PAYMENT AUG 2005 & \\
\cline{1-2}
PAY\_AMT3 & PAYMENT JUL 2005 & \\
\cline{1-2}
PAY\_AMT4 & PAYMENT JUN 2005 & \\
\cline{1-2}
PAY\_AMT5 & PAYMENT MAY 2005 & \\
\cline{1-2}
PAY\_AMT6 & PAYMENT APR 2005 & \multirow{-6}{20em}{\centering\arraybackslash PAYMENT MADE}\\
\cline{1-3}
DEFAULT & DEFAULTING CUSTOMER & 1 = DEFAULT, 0 = NON-DEFAULT\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Get stats on the data}
\NormalTok{skimr}\OperatorTok{::}\KeywordTok{skim_with}\NormalTok{(}\DataTypeTok{numeric =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{hist =} \OtherTok{NULL}\NormalTok{),}\DataTypeTok{integer =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{hist =} \OtherTok{NULL}\NormalTok{))}
\NormalTok{skimr}\OperatorTok{::}\KeywordTok{skim_to_wide}\NormalTok{(creditdata)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 30 x 15
##    type  variable missing complete n     n_unique top_counts ordered mean 
##    <chr> <chr>    <chr>   <chr>    <chr> <chr>    <chr>      <chr>   <chr>
##  1 fact~ data.gr~ 0       30000    30000 3        1: 15180,~ FALSE   <NA> 
##  2 fact~ DEFAULT  0       30000    30000 2        0: 23364,~ FALSE   <NA> 
##  3 fact~ EDUCATI~ 0       30000    30000 7        2: 14030,~ FALSE   <NA> 
##  4 fact~ MARRIAGE 0       30000    30000 4        2: 15964,~ FALSE   <NA> 
##  5 fact~ SEX      0       30000    30000 2        2: 18112,~ FALSE   <NA> 
##  6 inte~ AGE      0       30000    30000 <NA>     <NA>       <NA>    "   ~
##  7 inte~ BILL_AM~ 0       30000    30000 <NA>     <NA>       <NA>    " 51~
##  8 inte~ BILL_AM~ 0       30000    30000 <NA>     <NA>       <NA>    " 49~
##  9 inte~ BILL_AM~ 0       30000    30000 <NA>     <NA>       <NA>    " 47~
## 10 inte~ BILL_AM~ 0       30000    30000 <NA>     <NA>       <NA>    " 43~
## # ... with 20 more rows, and 6 more variables: sd <chr>, p0 <chr>,
## #   p25 <chr>, p50 <chr>, p75 <chr>, p100 <chr>
\end{verbatim}

\hypertarget{data-issues}{%
\subsection{3.1 Data Issues}\label{data-issues}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Unexpected categories in Education and Marriage
\item
  There are negative bill amounts; they are assumed to be overpayment of
  credits incurred.
\item
  PAY\_0 is assumed to be PAY\_1
\item
  Repayment status has negative values below -1.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lattice}\OperatorTok{::}\KeywordTok{barchart}\NormalTok{(}\OperatorTok{~}\KeywordTok{table}\NormalTok{(EDUCATION), creditdata, }\DataTypeTok{ylab =} \StringTok{"Education"}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{"Frequency"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{data.group =} \KeywordTok{ifelse}\NormalTok{(data.group }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{"Train"}\NormalTok{, }\KeywordTok{ifelse}\NormalTok{(data.group }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{, }\StringTok{"Test"}\NormalTok{, }\StringTok{"Validate"}\NormalTok{))) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{group_by}\NormalTok{(data.group) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{datapoints =} \KeywordTok{n}\NormalTok{()) }\OperatorTok{%>%}\StringTok{ }\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{()}

\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(train,test,validate) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{colSums}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Bill amount -ve ? }
\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{matches}\NormalTok{(}\StringTok{"BILL_|PAY_|DEF"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{#filter(BILL_AMT1 < 0 ) %>% }
\StringTok{  }\KeywordTok{filter_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{matches}\NormalTok{(}\StringTok{'PAY_[0-9]'}\NormalTok{)),}\KeywordTok{any_vars}\NormalTok{(.}\OperatorTok{==}\DecValTok{1}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{View}\NormalTok{()}


\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{BILLs =} \KeywordTok{rowSums2}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"BILL_AMT[2-6]"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{()),}
         \DataTypeTok{Paid =} \KeywordTok{rowSums2}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"PAY_AMT[1-5]"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{())) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{PaidFully =} \KeywordTok{ifelse}\NormalTok{(BILLs }\OperatorTok{-}\StringTok{ }\NormalTok{Paid }\OperatorTok{==}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(ID,PaidFully) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(PaidFully }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{feature-engineering}{%
\section{4. Feature Engineering}\label{feature-engineering}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Pay Ratip
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# ------------------------------------------------------------}
\CommentTok{# PAY RATIO defined as payment over bill }
\CommentTok{# Make the PAY_RATIO as 1 when the buill and pay amounts are 0}
\CommentTok{#-------------------------------------------------------------}
\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{PMT_RATIO2 =} \KeywordTok{ifelse}\NormalTok{(PAY_AMT1}\OperatorTok{==}\DecValTok{0} \OperatorTok{&}\StringTok{ }\NormalTok{BILL_AMT2}\OperatorTok{==}\DecValTok{0}\OperatorTok{|}\NormalTok{BILL_AMT2 }\OperatorTok{<=}\StringTok{ }\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,PAY_AMT1}\OperatorTok{/}\NormalTok{BILL_AMT2),}
         \DataTypeTok{PMT_RATIO3 =} \KeywordTok{ifelse}\NormalTok{(PAY_AMT2}\OperatorTok{==}\DecValTok{0} \OperatorTok{&}\StringTok{ }\NormalTok{BILL_AMT3}\OperatorTok{==}\StringTok{ }\DecValTok{0}\OperatorTok{|}\NormalTok{BILL_AMT3 }\OperatorTok{<=}\StringTok{ }\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,PAY_AMT2}\OperatorTok{/}\NormalTok{BILL_AMT3),}
         \DataTypeTok{PMT_RATIO4 =} \KeywordTok{ifelse}\NormalTok{(PAY_AMT3}\OperatorTok{==}\DecValTok{0} \OperatorTok{&}\StringTok{ }\NormalTok{BILL_AMT4}\OperatorTok{==}\DecValTok{0}\OperatorTok{|}\NormalTok{BILL_AMT4 }\OperatorTok{<=}\StringTok{ }\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,PAY_AMT3}\OperatorTok{/}\NormalTok{BILL_AMT4),}
         \DataTypeTok{PMT_RATIO5 =} \KeywordTok{ifelse}\NormalTok{(PAY_AMT4}\OperatorTok{==}\DecValTok{0} \OperatorTok{&}\StringTok{ }\NormalTok{BILL_AMT5}\OperatorTok{==}\DecValTok{0}\OperatorTok{|}\NormalTok{BILL_AMT5 }\OperatorTok{<=}\StringTok{ }\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,PAY_AMT4}\OperatorTok{/}\NormalTok{BILL_AMT5),}
         \DataTypeTok{PMT_RATIO6 =} \KeywordTok{ifelse}\NormalTok{(PAY_AMT5}\OperatorTok{==}\DecValTok{0} \OperatorTok{&}\StringTok{ }\NormalTok{BILL_AMT6}\OperatorTok{==}\DecValTok{0}\OperatorTok{|}\NormalTok{BILL_AMT6 }\OperatorTok{<=}\StringTok{ }\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,PAY_AMT5}\OperatorTok{/}\NormalTok{BILL_AMT6)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
         \DataTypeTok{Avg_PMT_RATIO =} \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{rowSums}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"BILL_AMT[2-6]"}\NormalTok{)))}\OperatorTok{==}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\KeywordTok{rowSums}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"PAY_AMT[1-5]"}\NormalTok{)))}\OperatorTok{/}\KeywordTok{rowSums}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"BILL_AMT[2-6]"}\NormalTok{)))))}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Utilization of Credit limit
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(matrixStats)}

\CommentTok{# Utilization defined as a % usage of credit limit. When there is a negative bill the util is made 0.}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{UTIL_1 =} \KeywordTok{ifelse}\NormalTok{(BILL_AMT1}\OperatorTok{/}\NormalTok{LIMIT_BAL }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{ , }\DecValTok{0}\NormalTok{ , BILL_AMT1}\OperatorTok{/}\NormalTok{LIMIT_BAL),}
         \DataTypeTok{UTIL_2 =} \KeywordTok{ifelse}\NormalTok{(BILL_AMT2}\OperatorTok{/}\NormalTok{LIMIT_BAL }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{ , }\DecValTok{0}\NormalTok{ , BILL_AMT2}\OperatorTok{/}\NormalTok{LIMIT_BAL),}
         \DataTypeTok{UTIL_3 =} \KeywordTok{ifelse}\NormalTok{(BILL_AMT3}\OperatorTok{/}\NormalTok{LIMIT_BAL }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{ , }\DecValTok{0}\NormalTok{ , BILL_AMT3}\OperatorTok{/}\NormalTok{LIMIT_BAL),}
         \DataTypeTok{UTIL_4 =} \KeywordTok{ifelse}\NormalTok{(BILL_AMT4}\OperatorTok{/}\NormalTok{LIMIT_BAL }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{ , }\DecValTok{0}\NormalTok{ , BILL_AMT4}\OperatorTok{/}\NormalTok{LIMIT_BAL),}
         \DataTypeTok{UTIL_5 =} \KeywordTok{ifelse}\NormalTok{(BILL_AMT5}\OperatorTok{/}\NormalTok{LIMIT_BAL }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{ , }\DecValTok{0}\NormalTok{ , BILL_AMT5}\OperatorTok{/}\NormalTok{LIMIT_BAL),}
         \DataTypeTok{UTIL_6 =} \KeywordTok{ifelse}\NormalTok{(BILL_AMT6}\OperatorTok{/}\NormalTok{LIMIT_BAL }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{ , }\DecValTok{0}\NormalTok{ , BILL_AMT6}\OperatorTok{/}\NormalTok{LIMIT_BAL))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# notice the utilization of the population is increasing over time?}
\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"UTIL"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\NormalTok{skimr}\OperatorTok{::}\KeywordTok{skim}\NormalTok{()}

\CommentTok{# balance increasing?}
\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"PAY_RAT"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\NormalTok{skimr}\OperatorTok{::}\KeywordTok{skim}\NormalTok{()}

\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"BILL_AMT"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\NormalTok{skimr}\OperatorTok{::}\KeywordTok{skim}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\item
  Average Bill and Payment amounts
\item
  Velocity of Bill amount increase, payment amount decrease, utilization
  increase, pay ratio decrease.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#--------------------------------------------------------------------------------------------------------------}
\CommentTok{# While we that the median balance increases over time, how much of the population is causing this to increase}
\CommentTok{# Calculate the difference between subsequent months in UTIL and BIll_AMTs}
\CommentTok{#--------------------------------------------------------------------------------------------------------------}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Avg_UTIL =} \KeywordTok{rowMeans}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"UTIL"}\NormalTok{))),}
         \DataTypeTok{UTILMR5 =}\NormalTok{ UTIL_}\DecValTok{5} \OperatorTok{-}\StringTok{ }\NormalTok{UTIL_}\DecValTok{6}\NormalTok{,}
         \DataTypeTok{UTILMR4 =}\NormalTok{ UTIL_}\DecValTok{4} \OperatorTok{-}\StringTok{ }\NormalTok{UTIL_}\DecValTok{5}\NormalTok{,}
         \DataTypeTok{UTILMR3 =}\NormalTok{ UTIL_}\DecValTok{3} \OperatorTok{-}\StringTok{ }\NormalTok{UTIL_}\DecValTok{4}\NormalTok{,}
         \DataTypeTok{UTILMR2 =}\NormalTok{ UTIL_}\DecValTok{2} \OperatorTok{-}\StringTok{ }\NormalTok{UTIL_}\DecValTok{3}\NormalTok{,}
         \DataTypeTok{UTILMR1 =}\NormalTok{ UTIL_}\DecValTok{1} \OperatorTok{-}\StringTok{ }\NormalTok{UTIL_}\DecValTok{2}\NormalTok{,}
         \DataTypeTok{Avg_BILL_Amt =} \KeywordTok{rowMeans}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"BILL_AMT"}\NormalTok{)),}\DataTypeTok{na.rm =}\NormalTok{ T),}
         \DataTypeTok{stdBILL =} \KeywordTok{rowSds}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"BILL_AMT"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{())) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ppk =}\NormalTok{ (LIMIT_BAL }\OperatorTok{-}\StringTok{ }\NormalTok{Avg_BILL_Amt)}\OperatorTok{/}\NormalTok{(}\DecValTok{3}\OperatorTok{*}\NormalTok{stdBILL),}
         \DataTypeTok{BILLAMTMR5 =}\NormalTok{ BILL_AMT5 }\OperatorTok{-}\StringTok{ }\NormalTok{BILL_AMT6,}
         \DataTypeTok{BILLAMTMR4 =}\NormalTok{ BILL_AMT4 }\OperatorTok{-}\StringTok{ }\NormalTok{BILL_AMT5,}
         \DataTypeTok{BILLAMTMR3 =}\NormalTok{ BILL_AMT3 }\OperatorTok{-}\StringTok{ }\NormalTok{BILL_AMT4,}
         \DataTypeTok{BILLAMTMR2 =}\NormalTok{ BILL_AMT2 }\OperatorTok{-}\StringTok{ }\NormalTok{BILL_AMT3,}
         \DataTypeTok{BILLAMTMR1 =}\NormalTok{ BILL_AMT1 }\OperatorTok{-}\StringTok{ }\NormalTok{BILL_AMT2,}
         \DataTypeTok{Avg_PMT_Amt =} \KeywordTok{rowMeans}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"PAY_AMT"}\NormalTok{)),}\DataTypeTok{na.rm =}\NormalTok{ T))}


\NormalTok{creditdata }\OperatorTok{%<>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{PAYMR5 =}\NormalTok{ PAY_AMT5 }\OperatorTok{-}\StringTok{ }\NormalTok{PAY_AMT6,}
         \DataTypeTok{PAYMR4 =}\NormalTok{ PAY_AMT4 }\OperatorTok{-}\StringTok{ }\NormalTok{PAY_AMT5,}
         \DataTypeTok{PAYMR3 =}\NormalTok{ PAY_AMT3 }\OperatorTok{-}\StringTok{ }\NormalTok{PAY_AMT4,}
         \DataTypeTok{PAYMR2 =}\NormalTok{ PAY_AMT2 }\OperatorTok{-}\StringTok{ }\NormalTok{PAY_AMT3,}
         \DataTypeTok{PAYMR1 =}\NormalTok{ PAY_AMT1 }\OperatorTok{-}\StringTok{ }\NormalTok{PAY_AMT2)}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Bal_Growth_6mo =}\NormalTok{ BILL_AMT1 }\OperatorTok{-}\StringTok{ }\NormalTok{BILL_AMT6,}
         \DataTypeTok{UTIL_Growth_6mo =}\NormalTok{ UTIL_}\DecValTok{1} \OperatorTok{-}\StringTok{ }\NormalTok{UTIL_}\DecValTok{6}\NormalTok{,}
         \DataTypeTok{PMT_RATIOMR5 =}\NormalTok{ PMT_RATIO5 }\OperatorTok{-}\StringTok{ }\NormalTok{PMT_RATIO6,}
         \DataTypeTok{PMT_RATIOMR4 =}\NormalTok{ PMT_RATIO4 }\OperatorTok{-}\StringTok{ }\NormalTok{PMT_RATIO5,}
         \DataTypeTok{PMT_RATIOMR3 =}\NormalTok{ PMT_RATIO3 }\OperatorTok{-}\StringTok{ }\NormalTok{PMT_RATIO4,}
         \DataTypeTok{PMT_RATIOMR2 =}\NormalTok{ PMT_RATIO2 }\OperatorTok{-}\StringTok{ }\NormalTok{PMT_RATIO3}
\NormalTok{         )}


  

\CommentTok{# Customers with increasing utilization over time}
\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"UTILM"}\NormalTok{)),}\KeywordTok{all_vars}\NormalTok{(. }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(ID) ->IDs}

\CommentTok{# customers with increasing Balance over time}
\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"BILLAMTMR"}\NormalTok{)),}\KeywordTok{all_vars}\NormalTok{(. }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(ID) ->BalIDs}

\CommentTok{# customers with decreasing payments over time}

\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"PAYMR"}\NormalTok{)),}\KeywordTok{all_vars}\NormalTok{(. }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(ID) ->payIDs}

\CommentTok{# customers with decreasing payment ratio over time}

\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"PMT_RATIOMR"}\NormalTok{)),}\KeywordTok{all_vars}\NormalTok{(. }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(ID) ->payRatioIDs}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{utilFlag =} \KeywordTok{ifelse}\NormalTok{(ID }\OperatorTok{%in%}\StringTok{ }\NormalTok{IDs}\OperatorTok{$}\NormalTok{ID,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{))}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{balFlag =} \KeywordTok{ifelse}\NormalTok{(ID }\OperatorTok{%in%}\StringTok{ }\NormalTok{BalIDs}\OperatorTok{$}\NormalTok{ID,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{))}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{payFlag =} \KeywordTok{ifelse}\NormalTok{(ID }\OperatorTok{%in%}\StringTok{ }\NormalTok{payIDs}\OperatorTok{$}\NormalTok{ID,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{))}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{payRatioFlag =} \KeywordTok{ifelse}\NormalTok{(ID }\OperatorTok{%in%}\StringTok{ }\NormalTok{payRatioIDs}\OperatorTok{$}\NormalTok{ID,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{))}


\KeywordTok{table}\NormalTok{(creditdata}\OperatorTok{$}\NormalTok{DEFAULT,creditdata}\OperatorTok{$}\NormalTok{utilFlag)}

\KeywordTok{chisq.test}\NormalTok{(}\KeywordTok{table}\NormalTok{(creditdata}\OperatorTok{$}\NormalTok{DEFAULT,creditdata}\OperatorTok{$}\NormalTok{utilFlag))}


\KeywordTok{table}\NormalTok{(creditdata}\OperatorTok{$}\NormalTok{DEFAULT,creditdata}\OperatorTok{$}\NormalTok{balFlag)}

\KeywordTok{chisq.test}\NormalTok{(}\KeywordTok{table}\NormalTok{(creditdata}\OperatorTok{$}\NormalTok{DEFAULT,creditdata}\OperatorTok{$}\NormalTok{balFlag))}

\KeywordTok{table}\NormalTok{(creditdata}\OperatorTok{$}\NormalTok{DEFAULT,creditdata}\OperatorTok{$}\NormalTok{payFlag)}

\KeywordTok{chisq.test}\NormalTok{(}\KeywordTok{table}\NormalTok{(creditdata}\OperatorTok{$}\NormalTok{DEFAULT,creditdata}\OperatorTok{$}\NormalTok{payFlag))}


\CommentTok{## Get percentage increase between month 6 and month 1}

\NormalTok{creditdata }\OperatorTok{%<>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{PerBALinc =}\NormalTok{ (BILL_AMT6 }\OperatorTok{-}\StringTok{ }\NormalTok{BILL_AMT1)}\OperatorTok{/}\NormalTok{BILL_AMT6,}
         \DataTypeTok{PerUTILinc =}\NormalTok{ (UTIL_}\DecValTok{6} \OperatorTok{-}\StringTok{ }\NormalTok{UTIL_}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{UTIL_}\DecValTok{6}
\NormalTok{         )}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Max Bill and Payments
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Max_Bill_Amt =} \KeywordTok{rowMaxs}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"BILL_AMT[0-9]"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{()),}
         \DataTypeTok{Max_Pmt_Amt =} \KeywordTok{rowMaxs}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"PAY_AMT[0-9]"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{()))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Customers delinquent often}
\NormalTok{creditdata }\OperatorTok{%<>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Max_Dlq =} \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{rowMaxs}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"PAY_[0-9]"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{()) }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\KeywordTok{rowMaxs}\NormalTok{(}\KeywordTok{select}\NormalTok{(.,}\KeywordTok{matches}\NormalTok{(}\StringTok{"PAY_[0-9]"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{()) ))}

\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(ID,}\KeywordTok{matches}\NormalTok{(}\StringTok{"PAY_[0-9]"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{gather}\NormalTok{(}\DataTypeTok{key =} \StringTok{"Period"}\NormalTok{, }\DataTypeTok{value =} \StringTok{"DLQ"}\NormalTok{,}\OperatorTok{-}\NormalTok{ID) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{DLQ =} \KeywordTok{ifelse}\NormalTok{(DLQ }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{,DLQ)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{group_by}\NormalTok{(ID) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{DLQs =} \KeywordTok{count}\NormalTok{(DLQ }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{),}
            \DataTypeTok{DLQ_Total =} \KeywordTok{sum}\NormalTok{(DLQ),}
            \DataTypeTok{DLQ_Max =} \KeywordTok{max}\NormalTok{(DLQ)) ->}\StringTok{ }\NormalTok{Delequencies}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{left_join}\NormalTok{(Delequencies)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Age Bucketing
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{AgeBins =} \KeywordTok{cut}\NormalTok{(AGE,}\DataTypeTok{breaks =} \KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \DecValTok{25}\NormalTok{, }\DataTypeTok{to =} \DecValTok{80}\NormalTok{,}\DataTypeTok{by =} \DecValTok{5}\NormalTok{)))}
  
\NormalTok{Information}\OperatorTok{::}\KeywordTok{create_infotables}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(AGE, DEFAULT) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{DEFAULT =} \KeywordTok{as.numeric}\NormalTok{(DEFAULT)}\OperatorTok{-}\DecValTok{1}\NormalTok{), }\DataTypeTok{y =} \StringTok{"DEFAULT"}\NormalTok{, }\DataTypeTok{parallel =}\NormalTok{ T, }\DataTypeTok{bins =} \DecValTok{7}\NormalTok{) ->}\StringTok{ }\NormalTok{tst7}

\NormalTok{Information}\OperatorTok{::}\KeywordTok{plot_infotables}\NormalTok{(tst7,}\StringTok{"AGE"}\NormalTok{)}

\NormalTok{Information}\OperatorTok{::}\KeywordTok{create_infotables}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(AGE, DEFAULT) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{DEFAULT =} \KeywordTok{as.numeric}\NormalTok{(DEFAULT)}\OperatorTok{-}\DecValTok{1}\NormalTok{), }\DataTypeTok{y =} \StringTok{"DEFAULT"}\NormalTok{, }\DataTypeTok{parallel =}\NormalTok{ T, }\DataTypeTok{bins =} \DecValTok{6}\NormalTok{) ->}\StringTok{ }\NormalTok{tst6}

\NormalTok{Information}\OperatorTok{::}\KeywordTok{plot_infotables}\NormalTok{(tst6,}\StringTok{"AGE"}\NormalTok{)}


\NormalTok{Information}\OperatorTok{::}\KeywordTok{create_infotables}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(AGE, DEFAULT) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{DEFAULT =} \KeywordTok{as.numeric}\NormalTok{(DEFAULT)}\OperatorTok{-}\DecValTok{1}\NormalTok{), }\DataTypeTok{y =} \StringTok{"DEFAULT"}\NormalTok{, }\DataTypeTok{parallel =}\NormalTok{ T, }\DataTypeTok{bins =} \DecValTok{5}\NormalTok{) ->}\StringTok{ }\NormalTok{tst5}

\NormalTok{Information}\OperatorTok{::}\KeywordTok{plot_infotables}\NormalTok{(tst5,}\StringTok{"AGE"}\NormalTok{)}

\NormalTok{Information}\OperatorTok{::}\KeywordTok{create_infotables}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ creditdata }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(AGE, DEFAULT) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{DEFAULT =} \KeywordTok{as.numeric}\NormalTok{(DEFAULT)}\OperatorTok{-}\DecValTok{1}\NormalTok{), }\DataTypeTok{y =} \StringTok{"DEFAULT"}\NormalTok{, }\DataTypeTok{parallel =}\NormalTok{ T, }\DataTypeTok{bins =} \DecValTok{4}\NormalTok{) ->}\StringTok{ }\NormalTok{tst4}

\NormalTok{Information}\OperatorTok{::}\KeywordTok{plot_infotables}\NormalTok{(tst4,}\StringTok{"AGE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(OneR)}

\NormalTok{OneR}\OperatorTok{::}\KeywordTok{optbin}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(DEFAULT) }\OperatorTok{~}\StringTok{ }\NormalTok{AGE, }\DataTypeTok{data =}\NormalTok{ creditdata, }\DataTypeTok{method =} \StringTok{"infogain"}\NormalTok{)->}\StringTok{ }\NormalTok{optbin}

\KeywordTok{plot}\NormalTok{(optbin)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tst6}\OperatorTok{$}\NormalTok{Tables}\OperatorTok{$}\NormalTok{AGE}\OperatorTok{$}\NormalTok{AGE}

\NormalTok{creditdata }\OperatorTok{%<>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{AGE_21_25 =} \KeywordTok{ifelse}\NormalTok{(AGE}\OperatorTok{>=}\DecValTok{21} \OperatorTok{&}\StringTok{ }\NormalTok{AGE}\OperatorTok{<=}\DecValTok{25}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{AGE_26_29 =} \KeywordTok{ifelse}\NormalTok{(AGE}\OperatorTok{>=}\DecValTok{26} \OperatorTok{&}\StringTok{ }\NormalTok{AGE}\OperatorTok{<=}\DecValTok{29}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{AGE_30_33 =} \KeywordTok{ifelse}\NormalTok{(AGE}\OperatorTok{>=}\DecValTok{30} \OperatorTok{&}\StringTok{ }\NormalTok{AGE}\OperatorTok{<=}\DecValTok{33}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{AGE_34_38 =} \KeywordTok{ifelse}\NormalTok{(AGE}\OperatorTok{>=}\DecValTok{34} \OperatorTok{&}\StringTok{ }\NormalTok{AGE}\OperatorTok{<=}\DecValTok{38}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{),}
         \DataTypeTok{AGE_39_44 =} \KeywordTok{ifelse}\NormalTok{(AGE}\OperatorTok{>=}\DecValTok{39} \OperatorTok{&}\StringTok{ }\NormalTok{AGE}\OperatorTok{<=}\DecValTok{44}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{feature-selection}{%
\subsection{Feature Selection}\label{feature-selection}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{creditdata }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(train }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{train,}\OperatorTok{-}\NormalTok{test,}\OperatorTok{-}\NormalTok{validate,}\OperatorTok{-}\NormalTok{u,}\OperatorTok{-}\NormalTok{data.group,}\OperatorTok{-}\NormalTok{ID) ->}\StringTok{ }\NormalTok{trainData}

\NormalTok{ctrl <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"cv"}\NormalTok{,}
                     \DataTypeTok{summaryFunction =}\NormalTok{ twoClassSummary,}
                     \DataTypeTok{classProbs =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{x =}\StringTok{ }\NormalTok{trainData }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{DEFAULT)}
\NormalTok{y =}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(creditdata}\OperatorTok{$}\NormalTok{DEFAULT[creditdata}\OperatorTok{$}\NormalTok{train}\OperatorTok{==}\DecValTok{1}\NormalTok{])}
\KeywordTok{levels}\NormalTok{(y) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"no"}\NormalTok{,}\StringTok{"yes"}\NormalTok{)}
\NormalTok{rpartFit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }
                  \DataTypeTok{y =}\NormalTok{ y,}
                  \DataTypeTok{method =} \StringTok{"rpart"}\NormalTok{,}
                  \DataTypeTok{tuneLength =} \DecValTok{10}\NormalTok{,}
                  \DataTypeTok{metric =} \StringTok{"ROC"}\NormalTok{,}
                  \DataTypeTok{trControl =}\NormalTok{ ctrl)}

\KeywordTok{plot}\NormalTok{(rpartFit)}



\KeywordTok{library}\NormalTok{(doParallel)}
\NormalTok{cl <-}\StringTok{ }\KeywordTok{makePSOCKcluster}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\KeywordTok{registerDoParallel}\NormalTok{(cl)}

\NormalTok{rfFit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{ppk,}\OperatorTok{-}\NormalTok{PerBALinc,}\OperatorTok{-}\NormalTok{PerUTILinc) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(), }
                  \DataTypeTok{y =}\NormalTok{ y,}
                  \DataTypeTok{method =} \StringTok{"rf"}\NormalTok{,}
                  \DataTypeTok{tuneLength =} \DecValTok{10}\NormalTok{,}
                  \DataTypeTok{metric =} \StringTok{"ROC"}\NormalTok{,}
                  \DataTypeTok{trControl =}\NormalTok{ ctrl,}
\NormalTok{                  )}

\KeywordTok{stopCluster}\NormalTok{(cl)}

\KeywordTok{plot}\NormalTok{(rfFit)}
\KeywordTok{plot}\NormalTok{(}\KeywordTok{varImp}\NormalTok{(rfFit))}

\CommentTok{#skimr::skim(x)}
\end{Highlighting}
\end{Shaded}


\end{document}
